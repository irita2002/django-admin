{% extends "base.html" %}

{% load static %}
{% load i18n %}

{% block content %}
<html>
<head>
    <div class="card">
    <title>Existencias Existencias Totales</title>

</head>
<body>
    <h5 class="card-header">Consulta de existencias completas</h5>

  <div class="card-body">
    
    <form method="get" class="mb-4" >
      <div class="row">
        <div class="col-md-6">

        <select name="producto_id" class="form-select">
            <option  value="">Seleccione un producto</option>
            {% for producto in productos %}
                <option value="{{ producto.id }}" 
                    {% if producto_seleccionado and producto.id == producto_seleccionado.id %}selected{% endif %}>
                    {{ producto.nombre }} (Actual: {{ producto.cantidad }})
                </option>
            {% endfor %}
        </select>
</div>

        <div class="col-md-2">

        <button class="btn btn-primary" type="submit">Consultar</button>
    </div>

    </form>
    <div class="col-md-2">
    {% if producto_seleccionado %}
    <p class="display-5">{{ producto_seleccionado.nombre }}</p>
</div>
</div>
</div>

</div>
        
        <!-- Tabla para Bodegas -->
        <h3>Existencias en Bodegas</h3>
        <table class="table table-striped border border-black">
            <thead class="table-dark">
                <tr>
                    <th>Bodega</th>
                    <th>Cantidad</th>
                </tr>
            </thead>
            <tbody>
                {% for existencia in existencias_bodegas %}
                    <tr>
                        <td>{{ existencia.bodega.nombre }}</td>
                        <td>{{ existencia.cantidad }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="2">No hay existencias en bodegas</td>
                    </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td>Total Bodegas</td>
                    <td>{{ total_bodegas }}</td>
                </tr>
            </tfoot>
        </table>

        <!-- Tabla para Tiendas -->
        <h3>Existencias en Tiendas</h3>
        <table class="table table-striped border border-black">
            <thead class="table-dark">
                <tr>
                    <th>Tienda</th>
                    <th>Cantidad</th>
                </tr>
            </thead>
            <tbody>
                {% for existencia in existencias_tiendas %}
                    <tr>
                        <td>{{ existencia.tienda.nombre }}</td>
                        <td>{{ existencia.cantidad }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="2">No hay existencias en tiendas</td>
                    </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td>Total Tiendas</td>
                    <td>{{ total_tiendas }}</td>
                </tr>
            </tfoot>
        </table>

        <!-- Total General -->
        <div style="margin-top: 20px; font-size: 1.2em;">
            <strong>Total General (Bodegas + Tiendas):</strong> {{ gran_total }}
        </div>
    {% endif %}
</body>
</html>
{% endblock %}
